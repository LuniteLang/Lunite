import "std/sync.lun" as sync

fn is_prime(n: int) -> bool {
    if (2 > n) { return false }
    let i = 2
    while (n >= i * i) {
        if (n % i == 0) { return false }
        i = i + 1
    }
    return true
}

// Hàm chạy trong thread riêng
fn worker(chan: sync.Channel) {
    let count = 0
    let n = 2
    while (1000 > n) {
        if (is_prime(n)) {
            count = count + 1
        }
        n = n + 1
    }
    sync.send(chan, count)
}

fn main() {
    print("Starting Concurrency Test (Prime counting)...")
    let c = sync.new_channel()
    
    spawn worker(c)
    
    print("Waiting for result from worker thread...")
    let result = sync.recv(c)
    
    print("Worker found primes count:")
    lunite_print_int(result)
}